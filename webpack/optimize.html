<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack 构建速度优化 | 阿畅的博客</title>
    <meta name="generator" content="VuePress 1.4.1">
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?831c09097cdcc6b28d4d8b82e7a2603b";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
    <meta name="description" content="JavaScript，Vue，React，Webpack，HTML，CSS等技术分享">
    <meta name="author" content="achang">
    <meta name="keywords" content="前端全栈知识体系， JavaScript， Vue， react， webpack， HTML， CSS，JavaScript算法">
    <link rel="preload" href="/blog/assets/css/0.styles.8141bd51.css" as="style"><link rel="preload" href="/blog/assets/js/app.2a9e1d26.js" as="script"><link rel="preload" href="/blog/assets/js/2.b5c945b0.js" as="script"><link rel="preload" href="/blog/assets/js/100.d9c496b9.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.1c9cb128.js"><link rel="prefetch" href="/blog/assets/js/101.2dbefcdd.js"><link rel="prefetch" href="/blog/assets/js/102.f49cba67.js"><link rel="prefetch" href="/blog/assets/js/11.c5365335.js"><link rel="prefetch" href="/blog/assets/js/12.20c384c5.js"><link rel="prefetch" href="/blog/assets/js/13.61f1338a.js"><link rel="prefetch" href="/blog/assets/js/14.f2c80a95.js"><link rel="prefetch" href="/blog/assets/js/15.fb46f9ec.js"><link rel="prefetch" href="/blog/assets/js/16.3c06bc72.js"><link rel="prefetch" href="/blog/assets/js/17.6b9fcc1c.js"><link rel="prefetch" href="/blog/assets/js/18.56735f47.js"><link rel="prefetch" href="/blog/assets/js/19.969cecdd.js"><link rel="prefetch" href="/blog/assets/js/20.a65e4dc5.js"><link rel="prefetch" href="/blog/assets/js/21.0e66da52.js"><link rel="prefetch" href="/blog/assets/js/22.f4fdebc1.js"><link rel="prefetch" href="/blog/assets/js/23.44d8c7d7.js"><link rel="prefetch" href="/blog/assets/js/24.e5051be4.js"><link rel="prefetch" href="/blog/assets/js/25.dcc79434.js"><link rel="prefetch" href="/blog/assets/js/26.00c15f45.js"><link rel="prefetch" href="/blog/assets/js/27.355b2a79.js"><link rel="prefetch" href="/blog/assets/js/28.68fd4985.js"><link rel="prefetch" href="/blog/assets/js/29.d84cc35f.js"><link rel="prefetch" href="/blog/assets/js/3.75a46af6.js"><link rel="prefetch" href="/blog/assets/js/30.3fb21238.js"><link rel="prefetch" href="/blog/assets/js/31.50b37b70.js"><link rel="prefetch" href="/blog/assets/js/32.869bfdb4.js"><link rel="prefetch" href="/blog/assets/js/33.b28c193b.js"><link rel="prefetch" href="/blog/assets/js/34.395eb3af.js"><link rel="prefetch" href="/blog/assets/js/35.c9607dd7.js"><link rel="prefetch" href="/blog/assets/js/36.406eefe2.js"><link rel="prefetch" href="/blog/assets/js/37.b2df7963.js"><link rel="prefetch" href="/blog/assets/js/38.9aacdff1.js"><link rel="prefetch" href="/blog/assets/js/39.34efcf53.js"><link rel="prefetch" href="/blog/assets/js/4.6b6fa8d7.js"><link rel="prefetch" href="/blog/assets/js/40.4d190766.js"><link rel="prefetch" href="/blog/assets/js/41.dcb0dea2.js"><link rel="prefetch" href="/blog/assets/js/42.4751f5ea.js"><link rel="prefetch" href="/blog/assets/js/43.1c65769a.js"><link rel="prefetch" href="/blog/assets/js/44.e2617f11.js"><link rel="prefetch" href="/blog/assets/js/45.284f7399.js"><link rel="prefetch" href="/blog/assets/js/46.4bfc2e64.js"><link rel="prefetch" href="/blog/assets/js/47.18b91d63.js"><link rel="prefetch" href="/blog/assets/js/48.0eb5b63f.js"><link rel="prefetch" href="/blog/assets/js/49.040a5bb1.js"><link rel="prefetch" href="/blog/assets/js/5.4f36be39.js"><link rel="prefetch" href="/blog/assets/js/50.280a74de.js"><link rel="prefetch" href="/blog/assets/js/51.1bff542f.js"><link rel="prefetch" href="/blog/assets/js/52.21278878.js"><link rel="prefetch" href="/blog/assets/js/53.bc5246ce.js"><link rel="prefetch" href="/blog/assets/js/54.da98e62c.js"><link rel="prefetch" href="/blog/assets/js/55.41da599e.js"><link rel="prefetch" href="/blog/assets/js/56.0e5b1be4.js"><link rel="prefetch" href="/blog/assets/js/57.b3233b28.js"><link rel="prefetch" href="/blog/assets/js/58.d3aefbaf.js"><link rel="prefetch" href="/blog/assets/js/59.b9cec5f9.js"><link rel="prefetch" href="/blog/assets/js/6.5101726b.js"><link rel="prefetch" href="/blog/assets/js/60.0dc2c6a9.js"><link rel="prefetch" href="/blog/assets/js/61.4f15fd19.js"><link rel="prefetch" href="/blog/assets/js/62.22e1fa3a.js"><link rel="prefetch" href="/blog/assets/js/63.42f92443.js"><link rel="prefetch" href="/blog/assets/js/64.56bf1bf7.js"><link rel="prefetch" href="/blog/assets/js/65.9f9ba7cc.js"><link rel="prefetch" href="/blog/assets/js/66.a0149269.js"><link rel="prefetch" href="/blog/assets/js/67.958096a6.js"><link rel="prefetch" href="/blog/assets/js/68.ce31b0f8.js"><link rel="prefetch" href="/blog/assets/js/69.e0b63645.js"><link rel="prefetch" href="/blog/assets/js/7.f595f157.js"><link rel="prefetch" href="/blog/assets/js/70.04ba63ca.js"><link rel="prefetch" href="/blog/assets/js/71.14a3e361.js"><link rel="prefetch" href="/blog/assets/js/72.fe00762e.js"><link rel="prefetch" href="/blog/assets/js/73.56200c06.js"><link rel="prefetch" href="/blog/assets/js/74.a609f591.js"><link rel="prefetch" href="/blog/assets/js/75.4bb00fd2.js"><link rel="prefetch" href="/blog/assets/js/76.81ee7781.js"><link rel="prefetch" href="/blog/assets/js/77.a36daa4b.js"><link rel="prefetch" href="/blog/assets/js/78.76314acb.js"><link rel="prefetch" href="/blog/assets/js/79.23710e07.js"><link rel="prefetch" href="/blog/assets/js/8.3a49e8ed.js"><link rel="prefetch" href="/blog/assets/js/80.79f1e427.js"><link rel="prefetch" href="/blog/assets/js/81.09e15374.js"><link rel="prefetch" href="/blog/assets/js/82.1457d6e3.js"><link rel="prefetch" href="/blog/assets/js/83.c037e760.js"><link rel="prefetch" href="/blog/assets/js/84.61a7ef93.js"><link rel="prefetch" href="/blog/assets/js/85.ef000657.js"><link rel="prefetch" href="/blog/assets/js/86.7bbe8636.js"><link rel="prefetch" href="/blog/assets/js/87.0b020f6e.js"><link rel="prefetch" href="/blog/assets/js/88.6d380c7b.js"><link rel="prefetch" href="/blog/assets/js/89.9a22d7e4.js"><link rel="prefetch" href="/blog/assets/js/9.4705cb4e.js"><link rel="prefetch" href="/blog/assets/js/90.e1d50ec8.js"><link rel="prefetch" href="/blog/assets/js/91.3f1edaa3.js"><link rel="prefetch" href="/blog/assets/js/92.6fa69482.js"><link rel="prefetch" href="/blog/assets/js/93.dc85e9dc.js"><link rel="prefetch" href="/blog/assets/js/94.2f42b212.js"><link rel="prefetch" href="/blog/assets/js/95.4bf7ddff.js"><link rel="prefetch" href="/blog/assets/js/96.ad15f572.js"><link rel="prefetch" href="/blog/assets/js/97.8615c32e.js"><link rel="prefetch" href="/blog/assets/js/98.df4af9cf.js"><link rel="prefetch" href="/blog/assets/js/99.6bb9e42c.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.8141bd51.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">阿畅的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript" class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/javascript/basics/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/interview/" class="nav-link">
  js 面试题
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/algorithm/" class="nav-link">
  js 数据结构与算法
</a></li></ul></div></div><div class="nav-item"><a href="/blog/js-algorithm/" class="nav-link">
  js 算法与数据结构
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="react" class="dropdown-title"><span class="title">react</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/react/combat/" class="nav-link">
  react
</a></li><li class="dropdown-item"><!----> <a href="/blog/react/taro/" class="nav-link">
  taro
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/Vue/principle/" class="nav-link">
  Vue 原理
</a></li><li class="dropdown-item"><!----> <a href="/blog/Vue/combat/" class="nav-link">
  Vue 项目实战
</a></li></ul></div></div><div class="nav-item"><a href="/blog/webpack/" class="nav-link router-link-active">
  webpack
</a></div><div class="nav-item"><a href="/blog/typescript/" class="nav-link">
  TypeScript
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="nodejs" class="dropdown-title"><span class="title">nodejs</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/node/sequelize/" class="nav-link">
  sequelize
</a></li></ul></div></div><div class="nav-item"><a href="/blog/css-html/" class="nav-link">
  CSS+HTML
</a></div><div class="nav-item"><a href="/blog/http/" class="nav-link">
  http
</a></div><div class="nav-item"><a href="https://github.com/sunchang1996/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript" class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/javascript/basics/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/interview/" class="nav-link">
  js 面试题
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/algorithm/" class="nav-link">
  js 数据结构与算法
</a></li></ul></div></div><div class="nav-item"><a href="/blog/js-algorithm/" class="nav-link">
  js 算法与数据结构
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="react" class="dropdown-title"><span class="title">react</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/react/combat/" class="nav-link">
  react
</a></li><li class="dropdown-item"><!----> <a href="/blog/react/taro/" class="nav-link">
  taro
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/Vue/principle/" class="nav-link">
  Vue 原理
</a></li><li class="dropdown-item"><!----> <a href="/blog/Vue/combat/" class="nav-link">
  Vue 项目实战
</a></li></ul></div></div><div class="nav-item"><a href="/blog/webpack/" class="nav-link router-link-active">
  webpack
</a></div><div class="nav-item"><a href="/blog/typescript/" class="nav-link">
  TypeScript
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="nodejs" class="dropdown-title"><span class="title">nodejs</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/node/sequelize/" class="nav-link">
  sequelize
</a></li></ul></div></div><div class="nav-item"><a href="/blog/css-html/" class="nav-link">
  CSS+HTML
</a></div><div class="nav-item"><a href="/blog/http/" class="nav-link">
  http
</a></div><div class="nav-item"><a href="https://github.com/sunchang1996/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>学习 webpack</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/webpack/" class="sidebar-link">webpack 知识概括</a></li><li><a href="/blog/webpack/basics.html" class="sidebar-link">webpack 基础学习</a></li><li><a href="/blog/webpack/advance.html" class="sidebar-link">webpack 进阶用法</a></li><li><a href="/blog/webpack/dynamic-import.html" class="sidebar-link">代码分割和动态js</a></li><li><a href="/blog/webpack/component.html" class="sidebar-link">webpack 打包组件和基础库</a></li><li><a href="/blog/webpack/optimize.html" class="active sidebar-link">webpack 构建速度优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/webpack/optimize.html#使用-webpack-内置的-stats" class="sidebar-link">使用 webpack 内置的 stats</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/optimize.html#速度分析" class="sidebar-link">速度分析</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/optimize.html#分析体积大小-webpack-bundle-analyzer" class="sidebar-link">分析体积大小 webpack-bundle-analyzer</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/optimize.html#使用高版本的-webpack-和-node-js" class="sidebar-link">使用高版本的 webpack 和 node.js</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/optimize.html#使用-多进程-多实例构建" class="sidebar-link">使用 多进程/ 多实例构建</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/optimize.html#使用-多进程-多实例-并行压缩" class="sidebar-link">使用 多进程/ 多实例 并行压缩</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/optimize.html#分包构建" class="sidebar-link">分包构建</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/optimize.html#利用缓存提升构建速度" class="sidebar-link">利用缓存提升构建速度</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/optimize.html#缩小构建目标来优化构建速度" class="sidebar-link">缩小构建目标来优化构建速度</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/optimize.html#tree-shaking" class="sidebar-link">Tree Shaking</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/optimize.html#图片压缩" class="sidebar-link">图片压缩</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/optimize.html#动态-polyfill" class="sidebar-link">动态 Polyfill</a></li></ul></li><li><a href="/blog/webpack/loader.html" class="sidebar-link">怎么编写一个 webpack loader</a></li><li><a href="/blog/webpack/plugins.html" class="sidebar-link">编写一个 webapck plugins</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack-构建速度优化"><a href="#webpack-构建速度优化" class="header-anchor">#</a> webpack 构建速度优化</h1> <h1 id="构建速度优化"><a href="#构建速度优化" class="header-anchor">#</a> 构建速度优化</h1> <h2 id="使用-webpack-内置的-stats"><a href="#使用-webpack-内置的-stats" class="header-anchor">#</a> 使用 webpack 内置的 stats</h2> <ul><li><p>stats 构建的统计信息</p></li> <li><p>package.json 中使用 stats</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;build:stats&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --env production --json &gt; stats.json&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>缺点：颗粒度太粗，看不出问题所在。</li></ul> <h2 id="速度分析"><a href="#速度分析" class="header-anchor">#</a> 速度分析</h2> <ul><li>使用 speed-measure-webpack-plugin 可以看到每个 loader 和插件执行耗时</li> <li>安装</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>yarn add speed-measure-webpack-plugin -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>使用</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> SpeedMeasurePlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;speed-measure-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token keyword">const</span> smp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpeedMeasurePlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token keyword">const</span> webpackConfig <span class="token operator">=</span> smp<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token operator">...</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="分析体积大小-webpack-bundle-analyzer"><a href="#分析体积大小-webpack-bundle-analyzer" class="header-anchor">#</a> 分析体积大小 webpack-bundle-analyzer</h2> <ul><li>安装</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev webpack<span class="token operator">-</span>bundle<span class="token operator">-</span>analyzer
or
yarn add <span class="token operator">-</span><span class="token constant">D</span> webpack<span class="token operator">-</span>bundle<span class="token operator">-</span>analyzer
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>使用</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> BundleAnalyzerPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-bundle-analyzer'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>BundleAnalyzerPlugin<span class="token punctuation">;</span>
 
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="使用高版本的-webpack-和-node-js"><a href="#使用高版本的-webpack-和-node-js" class="header-anchor">#</a> 使用高版本的 webpack 和 node.js</h2> <ul><li>因为 webpack 和 node 都在优化和迭代，使用高版本的可以有效优化打包构建速度</li></ul> <h3 id="使用-webpack4-优化原因"><a href="#使用-webpack4-优化原因" class="header-anchor">#</a> 使用 webpack4 优化原因</h3> <ul><li>v8 带来的优化（for of 替代 forEach、Map 和 Set 替代 Object，includes 替代 indexOf）</li> <li>默认使用更快的 md4 hash 算法</li> <li>webpack AST 可以直接从 loader 传递给 AST ，减少分析时间</li> <li>使用字符串方法替代正则表达式</li></ul> <h2 id="使用-多进程-多实例构建"><a href="#使用-多进程-多实例构建" class="header-anchor">#</a> 使用 多进程/ 多实例构建</h2> <h3 id="使用-happypack-解析资源"><a href="#使用-happypack-解析资源" class="header-anchor">#</a> 使用 HappyPack 解析资源</h3> <ul><li>原理： 每次 webapck 解析一个模块，HappyPack 会将它及它的依赖分配给 worker 线程中。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> HappyPack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'happypack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span>module <span class="token operator">=</span> <span class="token punctuation">{</span>
  loaders<span class="token operator">:</span> <span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token regex">/.js$/</span><span class="token punctuation">,</span>
    loader<span class="token operator">:</span> <span class="token string">'happypack/loader'</span><span class="token punctuation">,</span>
    include<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><blockquote><p>这个库作者已经不维护了，webpack4 后的推荐使用 thread-loader</p></blockquote> <h3 id="使用-thread-loader-解析资源"><a href="#使用-thread-loader-解析资源" class="header-anchor">#</a> 使用 thread-loader 解析资源</h3> <ul><li>原理： 每次 webpack 解析一个模块，thread-loader 会将它及它的依赖分配给 worker 线程中</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 安装</span>
npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev thread<span class="token operator">-</span>loader
<span class="token comment">// webapck.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
        include<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">'thread-loader'</span><span class="token punctuation">,</span>
          <span class="token comment">// your expensive loader (e.g babel-loader)</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="使用-多进程-多实例-并行压缩"><a href="#使用-多进程-多实例-并行压缩" class="header-anchor">#</a> 使用 多进程/ 多实例 并行压缩</h2> <h3 id="使用-parallel-uglify-plugin-插件"><a href="#使用-parallel-uglify-plugin-插件" class="header-anchor">#</a> 使用 parallel-uglify-plugin 插件</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> ParallelUglifyPlugin <span class="token keyword">from</span> <span class="token string">'webpack-parallel-uglify-plugin'</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">ParallelUglifyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      uglifyJS<span class="token operator">:</span> <span class="token punctuation">{</span>
        output<span class="token operator">:</span> <span class="token punctuation">{</span>
          beautify<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          comments<span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        comperss<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token comment">// 是否在UglifyJS删除没有用到的代码时输出警告信息，默认为输出，可以设置为false关闭这些作用</span>
          warnings<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          drop_console<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          collapse_vars<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          reduce_vars<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="使用-uglifyjs-webpack-plugin-开启-parallel-参数"><a href="#使用-uglifyjs-webpack-plugin-开启-parallel-参数" class="header-anchor">#</a> 使用 uglifyjs-webpack-plugin 开启 parallel 参数</h3> <ul><li>安装</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm i -D uglifyjs-webpack-plugin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>使用</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> UglifyJsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'uglifyjs-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">UglifyJsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      uglifyOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
        warnings<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        parse<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        compress<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        mangle<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        output<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        toplevel<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        nameCache<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        ie8<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        keep_fnames<span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      parallel<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="terser-webpack-plugin-开启-parallel-参数"><a href="#terser-webpack-plugin-开启-parallel-参数" class="header-anchor">#</a> terser-webpack-plugin 开启 parallel 参数</h3> <ul><li>推荐使用</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    minimizer<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">Terserplugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        parallel<span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="分包构建"><a href="#分包构建" class="header-anchor">#</a> 分包构建</h2> <h3 id="使用-html-webpack-externals-plugin"><a href="#使用-html-webpack-externals-plugin" class="header-anchor">#</a> 使用 html-webpack-externals-plugin</h3> <ul><li>将基础包通过 cdn 引入，不打入 bundle 中</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">HtmlWebpackExternalsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  externals<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      module<span class="token operator">:</span> <span class="token string">'react'</span><span class="token punctuation">,</span>
      entry<span class="token operator">:</span> <span class="token string">'https://cdn.bootcdn.net/ajax/libs/react/17.0.0/cjs/react.production.min.js'</span><span class="token punctuation">,</span>
      global<span class="token operator">:</span> <span class="token string">'React'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><blockquote><p>缺点如果需要多个基础包，引入的还是过多</p></blockquote> <h3 id="使用预编译资源模块"><a href="#使用预编译资源模块" class="header-anchor">#</a> 使用预编译资源模块</h3> <ul><li>思路：将 react react-dom redux  等基础包和业务基础包打成一个文件</li> <li>方法： 使用 DLLPlugin 进行分包，DllReferencePlugin 对 manifest.json 引用</li></ul> <h4 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h4> <ul><li>创建 webpack.dll.config.js</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  context<span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    library<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">'react'</span><span class="token punctuation">,</span>
      <span class="token string">'react-dom'</span><span class="token punctuation">,</span>
      <span class="token string">'redux'</span><span class="token punctuation">,</span>
      <span class="token string">'react-redux'</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// 如果有多个，直接在增加一个</span>
  <span class="token punctuation">}</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 这里打包后的文字是 library.dll.js</span>
    filename<span class="token operator">:</span> <span class="token string">'[name].dll.js'</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'build/libarary'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 暴露的库的名字</span>
    library<span class="token operator">:</span> <span class="token string">'[name]'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 指定包存放的位置</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">'[name]'</span><span class="token punctuation">,</span>
      <span class="token comment">// 描述动态链接库 mainfest 文件输出时的文件名称</span>
      <span class="token comment">// path: 'manifest.json'</span>
      path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'build/libarary/[name].json'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
    
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><ul><li>在 pageage.json scripts 中增加命令</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;dll&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --config webpack.dll.js&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>执行 npm run dll 分包</li> <li>在 webpack.config.js 引入</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// 刚打包后的json文件地址</span>
      <span class="token comment">// manifest: require('xxx.json'),</span>
      manifest<span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./build/library/libary.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 如果引入多个，使用多次此插件</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="利用缓存提升构建速度"><a href="#利用缓存提升构建速度" class="header-anchor">#</a> 利用缓存提升构建速度</h2> <ul><li><p>目的：提升二次构建速度</p></li> <li><p>缓存思路</p> <ul><li>babel-loader 开启缓存</li> <li>terser-webpack-plugin 开启缓存</li> <li>使用 cache-loader 或者 hard-source-webpack-plugin</li></ul></li> <li><p>开启缓存后 node_modules 下会有一个 .cache 目录</p></li></ul> <h3 id="babel-loader-开启缓存"><a href="#babel-loader-开启缓存" class="header-anchor">#</a> babel-loader 开启缓存</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>use<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
    options<span class="token operator">:</span> <span class="token punctuation">{</span>
      cacheDirectory<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="terser-webpack-plugin-开启缓存"><a href="#terser-webpack-plugin-开启缓存" class="header-anchor">#</a> terser-webpack-plugin 开启缓存</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    minimizer<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">Terserplugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        parallel<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        cache<span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="使用-hard-source-webpack-plugin-开启缓存"><a href="#使用-hard-source-webpack-plugin-开启缓存" class="header-anchor">#</a> 使用 hard-source-webpack-plugin 开启缓存</h3> <ul><li>安装</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev hard<span class="token operator">-</span>source<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin or yarn add <span class="token operator">--</span>dev hard<span class="token operator">-</span>source<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>使用</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// webpack.config.js</span>

<span class="token keyword">const</span> HardSourceWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'hard-source-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">HardSourceWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="缩小构建目标来优化构建速度"><a href="#缩小构建目标来优化构建速度" class="header-anchor">#</a> 缩小构建目标来优化构建速度</h2> <ul><li>目的：尽可能的少构建模块
<ul><li>如： babel-loader 不解析 node_modules</li></ul></li></ul> <h3 id="减少文件搜索范围"><a href="#减少文件搜索范围" class="header-anchor">#</a> 减少文件搜索范围</h3> <h4 id="合理使用-resolve-alias"><a href="#合理使用-resolve-alias" class="header-anchor">#</a> 合理使用 resolve.alias</h4> <ul><li>创建 import 或 require 的别名，来确保模块引入变得更简单。例如，一些位于 src/ 文件夹下的常用模块</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    alias<span class="token operator">:</span> <span class="token punctuation">{</span>
      react<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./node_modules/react/dist/react.min.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="resolve-modules-配置-减少模块搜索层级"><a href="#resolve-modules-配置-减少模块搜索层级" class="header-anchor">#</a> resolve.modules 配置 (减少模块搜索层级)</h4> <ul><li>告诉 webpack 解析模块时应该搜索的目录。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    modules<span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="resolve-mainfields"><a href="#resolve-mainfields" class="header-anchor">#</a> resolve.mainFields</h3> <ul><li>告诉 webpack 入口文件，此选项将决定在 package.json 中使用哪个字段导入模块。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">//指定入口文件 main 意思是从 package.json 中 main 字段中查找</span>
    mainFields<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'main'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="resolve-extensions"><a href="#resolve-extensions" class="header-anchor">#</a> resolve.extensions</h3> <ul><li>自定义解析确定的扩展。默认值是：</li> <li>模块路径的查找，例如： import Index from 'index' 没有写后缀，webpack 会先去找 index.js 文件，在去找 index.json</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;.js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.json&quot;</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>可以避免 webpack 做没意义的查找</li></ul> <h1 id="构建体积优化"><a href="#构建体积优化" class="header-anchor">#</a> 构建体积优化</h1> <h2 id="tree-shaking"><a href="#tree-shaking" class="header-anchor">#</a> Tree Shaking</h2> <ul><li>概念： 1 个模块可能有多个方法，只要其中某个方法使用到了，则整个问价你都会被打包到 bundle 里面去，tree shaking 就是只把用到的方法打入 bundle，没有到的会被 uglify 阶段被擦除掉。</li></ul> <h3 id="无用的-css-如何删除掉的？"><a href="#无用的-css-如何删除掉的？" class="header-anchor">#</a> 无用的 CSS 如何删除掉的？</h3> <ul><li><p>PurifyCSS：遍历代码，识别已经用到的 CSS Class （已经不维护了）</p></li> <li><p>uncss：HTML 需要通过 jsdom 加载，所有的样式通过 PostCss 解析，通过 document.querySelector 来识别在 HTML 文件里面不存在的选择器。</p></li> <li><p>使用 purgecss-webpack-plugin 和 mini-css-extract-plugin 配合使用</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> glob <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'glob'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> PurgeCSSPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'purgecss-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token constant">PATHS</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  src<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token operator">:</span> <span class="token punctuation">{</span>
  rules<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
      use<span class="token operator">:</span> <span class="token punctuation">[</span>
        MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>
        <span class="token string">&quot;css-loader&quot;</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">&quot;[name].css&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">PurgeCSSPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    paths<span class="token operator">:</span> glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">PATHS</span><span class="token punctuation">.</span>src<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/**/*</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>  <span class="token punctuation">{</span> nodir<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h2 id="图片压缩"><a href="#图片压缩" class="header-anchor">#</a> 图片压缩</h2> <ul><li>基于 Node 库 imagemin</li> <li>使用 配合 image-webpack-loader</li></ul> <h3 id="imagemin-的优点"><a href="#imagemin-的优点" class="header-anchor">#</a> imagemin 的优点</h3> <ul><li>有很多定制选项</li> <li>可以引入更多第三方插件，如 pngqeant</li> <li>可以处理多种图片格式</li></ul> <h3 id="图片压缩的原理-png"><a href="#图片压缩的原理-png" class="header-anchor">#</a> 图片压缩的原理 png</h3> <ul><li>pngquant: 是一款 PNG 压缩器，通过将图像转换为具有 alpha 通道 （通常比24/32位 PNG文件小 60%-80%）的更高效的 8 位 PNG 格式，可以显著减小文件大小。</li> <li>pngcrush: 主要目的是通过尝试不同的压缩级别和 PNG 过滤方法来降低 PNG IDAT 数据流的大小。</li> <li>optipng: 设计灵感来自于 pngcrush。optipng 可以将图像文件重新压缩更小尺寸，而不会丢失任何信息</li> <li>tinypng: 也是将 24 位 PNG 文件转化为更小有索引的 8 位图片，同时所有非必要的 metadata 也会被剥离掉。</li></ul> <h3 id="使用-image-webpack-loader"><a href="#使用-image-webpack-loader" class="header-anchor">#</a> 使用 image-webpack-loader</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install image-webpack-loader --save-dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// webpack.config.js</span>
rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex">/\.(gif|png|jpe?g|svg)$/i</span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'file-loader'</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      loader<span class="token operator">:</span> <span class="token string">'image-webpack-loader'</span><span class="token punctuation">,</span>
      options<span class="token operator">:</span> <span class="token punctuation">{</span>
        mozjpeg<span class="token operator">:</span> <span class="token punctuation">{</span>
          progressive<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// optipng.enabled: false will disable optipng</span>
        optipng<span class="token operator">:</span> <span class="token punctuation">{</span>
          enabled<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        pngquant<span class="token operator">:</span> <span class="token punctuation">{</span>
          quality<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0.65</span><span class="token punctuation">,</span> <span class="token number">0.90</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          speed<span class="token operator">:</span> <span class="token number">4</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        gifsicle<span class="token operator">:</span> <span class="token punctuation">{</span>
          interlaced<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// the webp option will enable WEBP</span>
        webp<span class="token operator">:</span> <span class="token punctuation">{</span>
          quality<span class="token operator">:</span> <span class="token number">75</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h2 id="动态-polyfill"><a href="#动态-polyfill" class="header-anchor">#</a> 动态 Polyfill</h2> <h3 id="polyfill-几种方案的优缺点"><a href="#polyfill-几种方案的优缺点" class="header-anchor">#</a> Polyfill 几种方案的优缺点</h3> <ol><li>babel-polyfill</li></ol> <ul><li>优点： React16官方推荐</li> <li>缺点：体积过大，难以抽离Map、Set。项目中 react 是单独用 CND 引入，使用时需要在 react 前加载。</li></ul> <ol start="2"><li>babel-plugin-transform-runtime</li></ol> <ul><li>优点：只能 polyfill 用到的类和方法，体积相对较小</li> <li>缺点：不能 polyfill 原型上的方法，不适用于业务复杂项目。</li></ul> <ol start="3"><li>自己map、set的polyfill</li></ol> <ul><li>优点：定制化高，体积小</li> <li>缺点：就算体积小，但是所有用户都需要加载，重复造轮子</li></ul> <ol start="4"><li>polyfill-service</li></ol> <ul><li>优点： 识别 User Agent，只给用户返回需要的 polyfill</li> <li>缺点：可能国内部分奇葩浏览器 UA 无法识别 （但可以降级返回所需全部）</li></ul> <h3 id="使用-2"><a href="#使用-2" class="header-anchor">#</a> 使用</h3> <ol><li>polyfill.io 官方提供的服务</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>polyfill<span class="token punctuation">.</span>io<span class="token operator">/</span>v3<span class="token operator">/</span>polyfill<span class="token punctuation">.</span>min<span class="token punctuation">.</span>js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>基于官方自建 polyfill 服务</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>polyfill<span class="token punctuation">.</span>io<span class="token operator">/</span>v3<span class="token operator">/</span>polyfill<span class="token punctuation">.</span>min<span class="token punctuation">.</span>js<span class="token operator">?</span>features<span class="token operator">=</span>es2015<span class="token operator">%</span><span class="token number">2</span>Ces2016<span class="token operator">%</span><span class="token number">2</span>Ces2017
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/webpack/component.html" class="prev">
        webpack 打包组件和基础库
      </a></span> <span class="next"><a href="/blog/webpack/loader.html">
        怎么编写一个 webpack loader
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.2a9e1d26.js" defer></script><script src="/blog/assets/js/2.b5c945b0.js" defer></script><script src="/blog/assets/js/100.d9c496b9.js" defer></script>
  </body>
</html>
